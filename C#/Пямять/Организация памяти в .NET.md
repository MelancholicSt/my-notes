## Основы
Во первых, память делится на два типа: **стек**(*stack*) и **куча**(*heap*)

Параметры и переменные **метода**, которые представляют типы **значений**, размещают своё значение **в стеке**. Стек - это структура данных, которая хранит элементы снизу вверх. Т.е. при добавлении нового элемента, он будет поверх предыдущего.
И время этих переменных будет ограничено их контекстом. 


### Немного определений:

**Физически стек** 
	Некая область памяти в [[#^6048c4|адресном пространстве]]

**Адресное пространство**
	Совокупность **всех допустимых адресов** каких-либо объектов.  ^6048c4

**Домен приложения**
	Механизм, реализованный в .NET, который позволяет запустить группу приложений в одном процессе, обеспечивая относительную изоляцию их друг от друга, в то же время позволяя им взаимодействовать друг с другом значительно быстрее, чем в случае отдельных процессов

## Работа памяти в домене приложений

![[54e906fd38e44c34c1fae378fb5732bc.png]]
	В каждом домене приложений AppDomain память разделена на две части. Системная (на схеме она отмечена красной рамкой) и пользовательская (голубая рамка).  
	Системная область не допускает прямого управления пользователем, и память в ней освобождается только при завершении домена (*за редким исключением*).

### Пользовательская область памяти
\
**Small Object Heap** 
	Куча для хранения маленьких объектов (в текущих реализациях .NET для объектов меньше 85000 байт). Разделённая на 3 поколения. 0 (эфемерное поколение), 1 и 2 поколение объектов. Для каждого из поколений установлен лимит памяти, и после того как он будет достигнут — может быть запущен сборщик мусора. При сборке мусора объекты «утрамбовываются» для избежания фрагментации памяти.  
  
 **Large Object Heap** 
	  Куча для больших объектов (в текущих реализациях .NET больше 85000 байт). Эта куча не разделена на поколения и в неё не выполняется дефрагментация.  
  
**Stack**
	Стек приложения. в нём выделяется память под структуры (*те, которые используются без боксинга, и не являющиеся полями классов*), ссылки на экземпляры классов, fixed и stackalloc. Каждая ссылка на объект содержит три поля.  
	Сам указатель на экземпляр (4 байта на 32-битных машинах, и 8 на 64-битных).  
	Индекс блока синхронизации (4 байта. На самом деле часть битов в нём выделена под системные флаги, например флаг пометки объекта к удалению сборщиком мусора).  
	Указатель на RuntimeType в системной области памяти.
## Далее [[Сборщик мусора]]